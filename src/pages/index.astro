---
import { getCollection } from 'astro:content';
import PostCard from '@/components/blog/PostCard.astro';
import BaseLayout from '@/components/layouts/BaseLayout.astro';
import SocialLinks from '@/components/SocialLinks.astro';

const allPosts = await getCollection('blog');

const twoYearsAgo = new Date();
twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);

const posts = allPosts
  .filter(({ data: { draft = false, date } }) => !draft && date >= twoYearsAgo)
  .sort(({ data: { date: dateA } }, { data: { date: dateB } }) => dateB.valueOf() - dateA.valueOf());

const pageDescription =
  '欢迎来到 Coderfee 的博客，这里记录了前端开发、技术思考和个人成长。探索最新的 Web 技术、框架实践和优化技巧。';
---

<BaseLayout title="首页" description={pageDescription}>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 py-12 sm:py-16">
    <main class="space-y-0">
      {posts.length > 0 ? (
        posts.map((post, index) => (
          <>
            <PostCard post={post} />
            {index < posts.length - 1 && (
              <div class="border-t border-dashed border-zinc-100 dark:border-zinc-800"></div>
            )}
          </>
        ))
      ) : (
        <div class="p-8 text-center bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800">
          <p class="text-lg text-zinc-600 dark:text-zinc-400">最近两年没有发布文章</p>
        </div>
      )}
    </main>

    {posts.length > 0 && (
      <div class="mt-12 flex justify-center">
        <a href="/archive"
           class="inline-flex items-center gap-2 px-6 py-3 text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100">
          查看所有文章
        </a>
      </div>
    )}
  </div>

  <SocialLinks />
</BaseLayout>
