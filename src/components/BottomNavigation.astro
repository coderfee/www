---
import ArchiveIcon from '~icons/tabler/archive';
import BookIcon from '~icons/tabler/book-2';
import SmartHomeIcon from '~icons/tabler/smart-home';

const pathname = new URL(Astro.request.url).pathname;
const isActive = (path: string) => {
  if (path === '/' && pathname === path) return true;
  if (path !== '/' && pathname.startsWith(path)) return true;
  return false;
};

const navItems = [
  { name: '首页', path: '/', icon: SmartHomeIcon },
  { name: '归档', path: '/archive', icon: ArchiveIcon },
  { name: '周刊', path: '/newsletter', icon: BookIcon },
];
---

<nav
  id="bottom-nav"
  class="md:hidden w-full fixed bottom-0 left-0 right-0 z-50 bg-white/80 dark:bg-zinc-900/80 backdrop-blur-md pb-[env(safe-area-inset-bottom)] transition-transform duration-300"
>
  <div class="flex h-14">
    {navItems.map((item) => (

      <a
        href={item.path}
        class:list={[
          'nav-tab flex-1 flex items-center justify-center transition-colors relative',
          isActive(item.path)
            ? 'text-zinc-900 dark:text-zinc-100'
            : 'text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100'
        ]}
        aria-current={isActive(item.path) ? 'page' : undefined}
        aria-label={item.name}
        title={item.name}
      >
        <item.icon class="w-6 h-6" />
        {isActive(item.path) && (
          <span class="absolute bottom-2 w-1 h-1 rounded-full bg-zinc-900 dark:bg-zinc-100" />
        )}
      </a>
    ))}
  </div>
</nav>

<script>
  function initHaptic() {
    const nav = document.getElementById('bottom-nav');
    if (nav && 'vibrate' in navigator) {
      nav.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (target.closest('.nav-tab')) {
          navigator.vibrate(10);
        }
      });
    }
  }

  // Initialize on load
  initHaptic();
  // Re-initialize after Astro view transitions
  document.addEventListener('astro:after-swap', initHaptic);
</script>
