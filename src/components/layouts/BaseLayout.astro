---
import BottomNavigation from '@/components/BottomNavigation.astro';
import TopNavigation from '@/components/TopNavigation.astro';
import DocumentMeta from './DocumentMeta.astro';

const { title, description, ogImage, showNavigation = true } = Astro.props;
---

<!doctype html>
<html lang="zh-Hans">
  <head>
    <DocumentMeta title={title} description={description} ogImage={ogImage} />
    <slot name="head" />
  </head>
  <body class="bg-white dark:bg-zinc-900 dark:text-white min-h-dvh flex flex-col overflow-x-hidden">
    {showNavigation && <TopNavigation />}

    <main class:list={["flex-1 w-full", showNavigation && "pb-14 md:pb-0"]}>
      <slot />
    </main>

    {showNavigation && <BottomNavigation />}

    <script async defer is:inline>
      function initCopyButtons() {
        const buttons = document.querySelectorAll('.copy-code');
        buttons.forEach((button) => {
          if (button.hasAttribute('data-initialized')) return;

          button.addEventListener('click', async () => {
            const pre = button.closest('pre');
            const code = pre?.querySelector('code');
            if (!code) return;

            try {
              await navigator.clipboard.writeText(code.innerText);
              button.textContent = '已复制!';
              button.classList.add('copied');
              setTimeout(() => {
                button.textContent = '复制';
                button.classList.remove('copied');
              }, 2000);
            } catch (err) {
              console.error('复制失败:', err);
            }
          });

          button.setAttribute('data-initialized', 'true');
        });
      }

      initCopyButtons();

      document.addEventListener('astro:after-swap', initCopyButtons);
    </script>
  </body>
</html>
